<div id="2023-10-31-oo" class="content">
  <div class="date">31 Outubro 2023</div>
  <img class="float-left" src="/img/gorm.png" alt="O.O." height="92" width="92" />
  <h2>Orienta√ß√£o a Objectos</h2>

  <p>Orienta√ß√£o a objetos √© um dos paradigmas mais populares de todos, que consiste
    em criar atores que trocam mensagens entre si. O programa consiste nessa troca
    de mensagens entre os atores, que podem ser n√∫meros, <em>strings</em>, conectores,
    ou artefatos ainda mais complexos.</p>
  <p>Quando um ator recebe uma mensagem, ele a trata usando um tipo especial de
    fun√ß√£o chamada <strong>m√©todo</strong>, que √© uma fun√ß√£o dentro do contexto do
    artefato em si, tendo acesso a todos os recursos privados.</p>
  <p>H√° diversos conceitos dentro da orienta√ß√£o a objetos, como por exemplo a forma
    como voc√™ pode criar seus atores ‚Äì chamados ‚Äúobjetos‚Äù, da√≠ programa√ß√£o orientada
    a objetos.</p>
  <p>H√° duas formas mais comuns de cria√ß√£o de objetos:</p>
  <ol>
    <li>Na orienta√ß√£o a objetos baseada em classes, voc√™ cria moldes de objetos,
      chamados <strong>classes</strong>, e os instancia, ou seja,  gera
      <strong>inst√¢ncias</strong> a partir desses moldes.</li>
    <li>Na orienta√ß√£o a objetos por prototipagem, voc√™ cria seus objetos diretamente,
      sem a necessidade de uma classe ou molde, e pode clonar os objetos para criar
      novos com a mesma estrutura. O objeto original √© chamado <strong>prot√≥tipo</strong>,
      e os objetos criados a partir dele s√£o chamados <strong>clones</strong>.</li>
  </ol>

  <h3>Heran√ßa</h3>
  <p>Quando trabalhando com classes, h√° alguns conceitos derivados que estendem a
    linguagem de um jeito muito poderoso, como por exemplo a heran√ßa.</p>
  <p>Heran√ßa consiste em criar uma classe que herda atributos e m√©todos de outra
    classe. Nesse caso, a classe original √© chamada de classe pai, e as que heram
    seus atributos s√£o as classes filhas.</p>

  <h3>Orienta√ß√£o a Aspectos</h3>
  <p>Dentro da orienta√ß√£o a objetos, outro conceito poderoso √© a orienta√ß√£o a aspectos.
    Ela consiste em criar as classes com o m√≠nimo de atributos e m√©todos necess√°rios
    para classific√°-las, muitas vezes podendo ser classes vazias. Ent√£o essas
    classes s√£o estendidas usando outras classes incompletas, chamadas <strong>aspectos</strong>,
    <em>concerns</em>, <em>mixins</em>, ou ainda outros nomes, dependendo da
    linguagem de programa√ß√£o e daquela comunidade de programadores em espec√≠fico.</p>
  <p>Por exemplo, podemos ter a classe <code>Ave</code>, que s√≥ possui atributos comuns
    a todas as aves, como por exemplo ter um bico, ser tetr√°pode e b√≠pede.</p>
  <p>Ent√£o criamos o aspecto <code>Voar</code>, e todas as aves voadoras ser√£o
    instanciadas a partir de <code>Ave+Voar</code>. Podemos ter tamb√©m o aspecto
    <code>Cantar</code>, e da√≠ aves que voam e cantam ser√£o instanciadas a partir de
    <code>Ave+Voar+Cantar</code>.</p>
  <p>Uma avestruz poderia ser <code>Ave+Correr</code>, enquanto um pinguim seria
    <code>Ave+Nadar</code>. Podemos ter o mergulh√£o: <code>Ave+Voar+Nadar</code>,
    e por a√≠ vai. Talvez a galinha possa ser:</p>
  <center><pre><code>Ave+Quase[Voar]+Quase[Correr]+Quase[Cantar]</code></pre></center>

  <p>E assim podemos ir compondo nossas aves conforme a necessidade, sem qualquer
    gordura nos objetos.</p>
  <p>Outra vantagem √© que, como m√©todos e atributos necess√°rios para a ave voar
    est√£o no aspecto <code>Voar</code>, e n√£o em <code>Ave</code>, podemos reutiliz√°-los
    para morcegos, por exemplo, em <code>Mam√≠fero+Voar</code>.</p>

  <h3>Primeiras Linguagens Orientadas a Objetos</h3>
  <p>A primeira linguagem de programa√ß√£o orientada a Objetos foi <strong>Simula ‚Ö†</strong>,
    criada em 1962 como um <em>superset</em> da
    <a target="_blank" href="https://www.masswerk.at/algol60/report.htm">ALGOL 60</a>
    (suportada hoje pelo
    <a target="_blank" href="https://docs.racket-lang.org/algol60/">DrRacket</a>),
    e logo em seguida
    <a target="_blank" href="https://www.mn.uio.no/ifi/personer/vit/dag/simula67/index.shtml">Simula 67</a>.</p>
  <p>Mas a orienta√ß√£o a objetos s√≥ ganhou popularidade com o advento do
    <strong>Smalltalk-80</strong>, criado durante a d√©cada de 1970 como um projeto do
    <a target="_blank" href="https://www.parc.com/">Xerox PARC</a>. Mais tarde o
    projeto foi adquirido pela <a target="_blank" href="https://www.disney.com/">Disney</a>,
    que o redistribui gratuitamente at√© hoje com o nome
    <a target="_blank" href="https://squeak.org/">Squeak</a> ‚Äì sim, em homenagem ao
    Mickey Mouse. ü§∑</p>
  <p>Outras implementa√ß√µes famosas de Smalltalk s√£o
    <a target="_blank" href="https://pharo.org/">Pharo</a>,
    <a target="_blank" href="https://www.cincomsmalltalk.com/main/products/visualworks/">Cincom VisualWorks</a>,
    <a target="_blank" href="https://www.gnu.org/software/smalltalk/">GNU Smalltalk</a>,
    <a target="_blank" href="https://www.strongtalk.org/">Strongtalk</a> e Smalltalk/X,
    al√©m do <a target="_blank" href="https://gemtalksystems.com/small-business/gsdevkit/">Open-source Development Kit for GemStone/S 64 Bit</a>,
    uma cole√ß√£o de programas para cria√ß√£o de um servi√ßo <em>on-line</em> com persist√™ncia
    de dados usando Smalltalk como linguagem de programa√ß√£o.</p>
  <p>Em 1981, Brad Cox e Tom Love criaram o
    <a target="_blank" href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/ProgrammingWithObjectiveC/Introduction/Introduction.html">Objective-C</a>,
    que √© basicamente C com instru√ß√µes Smalltalk <em>enfiados</em> na linguagem de modo
    alien√≠gena. Na mesma d√©cada, a
    <a target="_blank" href="https://web.archive.org/web/19970412194822/http://www.next.com/">NeXT</a>,
    empresa de Steve Jobs, adquiriu os direitos da linguagem, assim com fez com o <em>mouse</em> do PARC,
    para criar seu sistema operacional NeXTSTEP e sua interface de desenvolvimento
    de aplica√ß√µes (API), o
    <a target="_blank" href="https://gnustep.github.io/resources/OpenStepSpec/OpenStepSpec.html">OpenStep</a>.
    Na d√©cada seguinte, a
    <a target="_blank" href="https://www.apple.com/">Apple</a> viria a adquirir a empresa
    NeXT, junto com os direitos sobre o Objective-C.</a></p>
  <p>Em 1983, <a target="_blank" href="https://www.stroustrup.com/">Bjarne Stroustrup</a>
    desenvolveu a linguagem <a target="_blank" href="https://cplusplus.com/">C++</a>,
    s√≥ lan√ßada em 1985 sob o nome de ‚ÄúC with Classes‚Äù, o que descreve bem a linguagem
    em seus prim√≥rdios, que era apenas C com o <code>struct</code> transformado
    em <code>class</code>, ganhando recursos de orienta√ß√£o a objetos. A linguagem vem
    crescendo desde ent√£o, se distanciando do C original, que √© uma linguagem de tipagem
    fraca, o que n√£o √© conveniente para o orienta√ß√£o a objetos.</p>

  <h3>Orienta√ß√£o a Objetos e Programa√ß√£o Funcional s√£o excludentes entre si?</h3>
  <p>Resposta curta: <strong>N√ÉO</strong>.</p>
  <p>Vamos usar como exemplo para os c√≥digos
    <a target="_blank" href="https://scala-lang.org/">Scala</a>, uma linguagem
    funcional com recursos avan√ßados tanto de programa√ß√£o funcional, quanto de
    orienta√ß√£o a objetos.</p>

  <h3>Revisando o Algoritmo Fatorial</h3>
  <p>Em resumo:</p>
  <center>0! = 1<br/>n! = n √ó (n-1)!</center>

  <p>Para implementar isso, vamos criar um m√©todo para os n√∫meros inteiros que
    retorne 1 se o ator for 0, e o  passo se for outro:</p>
<pre class="prettyprint"><code class="Smalltalk">!Integer methodsFor: 'factorial'!
    fact
        (self = 0)
            ifTrue:  [‚Üë 1]
            ifFalse: [‚Üë n * ((n-1) fact)].
    !
!!</code></pre>

  <p>Ent√£o, para executar o fatorial, basta passar a mensagem <code>fact</code>
    para o n√∫mero.</p>

  <h3>Abordagem Ing√™nua</h3>
  <p>Vamos come√ßar com uma abordagem bem simpl√≥ria, apenas criando um aspecto
    para os n√∫meros inteiros que retorne o fatorial usando o algoritmo mais <em>na√Øve</em>
    poss√≠vel.</p>
  <p>Para isso precisamos de um objeto que contenha os recursos que iremos criar:</p>
<pre class="prettyprint"><code class="Scala">object Fact:</code></pre>

  <p>Agora, dentro dele, vamos criar nosso aspecto, que em Scala √© chamado
    <strong>extens√£o</strong>:</p>
<pre class="prettyprint"><code class="Scala">  extension(n: Int) def fact: BigInt = n match</code></pre>

  <p>Essa extens√£o √© uma  fun√ß√£o que ‚Äúcasa‚Äù o valor do n√∫mero inteiro, se for
    zero, retorna 1:</p>
<pre class="prettyprint"><code class="Scala">    case 0 =&gt; 1</code></pre>

  <p>Caso contr√°rio, calcula o passo:</p>
<pre class="prettyprint"><code class="Scala">    case n =&gt; n * (n-1).fact</code></pre>

  <p>Por √∫ltimo, precisamos trazer a extens√£o para o contexto atual:</p>
<pre class="prettyprint"><code class="Scala">import Fact._</code></pre>

  <p>E com isso nosso fatorial j√° funciona:</p>
<pre class="prettyprint"><code class="shell"><em>@</em> <strong>0.fact</strong>
<em>res1: BigInt = 1</em>
<em>@</em> <strong>5.fact</strong>
<em>res2: BigInt = 120</em>
<em>@</em> <strong>10.fact</strong>
<em>res3: BigInt = 3628800</em></code></pre>

  <p>Mas temos pelo menos dois problemas:</p>
  <ol>
    <li>N√£o estamos lidando com n√∫meros negativos;</li>
    <li>N√£o implementamos <a target="_blank" href="https://exploringjs.com/es6/ch_tail-calls.html">T.C.O.</a></li>
  </ol>

  <p>Ent√£o precisamos de uma interpreta√ß√£o mais rebuscada.</p>

  <h3>N√∫meros Naturais</h3>
  <p><a target="_blank" href="https://gist.github.com/cacilhas/f1e3c54eb53d81c916a074e5ac5ed760">Esta</a>
    √© a implementa√ß√£o can√¥nica dos n√∫meros naturais, mas ela √© demais para o que
    precisamos. Precisamos apenas dos n√∫meros inteiros, exceto os negativos.</p>
  <p>Vamos come√ßar por criar a classe que representa os n√∫meros naturais, que ser√°:</p>
    <ul>
      <li><code>final</code>, ou seja, n√£o pode ser usada em heran√ßa; </li>
      <li><code>case class</code>, o que nos d√° alguns recursos prontos, como
        aspectos para compara√ß√£o, serializa√ß√£o e instancia√ß√£o;</li>
      <li>de construtor privado, ou seja, somente pode ser instanciada dentro de
        nosso escopo controlado;</li>
      <li>e uma <em>value class</em> (<code>extends AnyVal</code>), ou seja, a
        classe s√≥ existe no c√≥digo, n√£o existe como entidade no objeto execut√°vel
        final.</li>
    </ul>

  <p>Ent√£o sua assinatura ser√°:</p>
<pre class="prettyprint"><code class="Scala">final case class Natural private(value: Int) extends AnyVal</code></pre>

  <p>E isso √© tudo que a classe <code>Natural</code> em si precisa, o resto ser√°
    implementado com conversores impl√≠citos, que v√£o invalidar n√∫meros negativos.</p>
  <p>Vamos agora ao objeto que encapsula os conversores, que ser√£o de inteiro para
    natural, dando erro para n√∫meros negativos, e de natural para inteiro:</p>
<pre class="prettyprint"><code class="Scala">object Natural:
  given Conversion[Int, Natural] with
    def apply(i: Int): Natural =
      if (i &gt;= 0) Natural(i)
      else throw new IllegalArgumentException(f"invalid negative number ${i}")

  give Conversion[Natural, Int] = (n: Natural) =&gt; n.value</code></pre>

  <p>Agora vamos trazer os conversores para o contexto atual:</p>
<pre class="prettyprint"><code class="Scala">import Natural._</code></pre>

  <p>J√° com suporte aos naturais, vamos criar nosso aspecto que extende os naturais
    acrescentando o m√©todo fatorial, usando T.C.O.</p>
  <p>Para ajudar a suportar T.C.O., Scala tem uma anota√ß√£o chamada <code>tailrec</code>:</p>
<pre class="prettyprint"><code class="Scala">import scala.annotation.tailrec</code></pre>

  <p>Vamos criar o ator que encapsula o aspecto que extende os naturais com o fatorial:</p>
<pre class="prettyprint"><code class="Scala">object Fact:
  extension(n: Natural)
    def fact: BigInt = _fact(1, n)</code></pre>

  <p>Reparem que inicializamos o aculumador com 1, quer √© o fatorial de zero (0!).</p>
  <p>Agora temos de criar o m√©todo <code>_fact</code>, que √© privado e com suporte a
    T.C.O.:</p>
<pre class="prettyprint"><code class="Scala">  @tailrec
  private def _fact(acc: BigInt, n: Natural):  BigInt =
    n match
      case Natural(0) =&gt; acc
      case Natural(n) =&gt; _fact(acc * n, n - 1)</code></pre>

  <p>E vamos trazer o aspecto para o contexto atual:</p>
<pre class="prettyprint"><code class="Scala">import Fact._</code></pre>

  <p>Est√° pronto o fatorial com n√∫meros naturais (n√£o-negativos) e T.C.O. Podemos
    experimentar:</p>
<pre class="prettyprint"><code class="shell"><em>@</em> <strong>0.fact</strong>
<em>res1: BigInt = 1</em>
<em>@</em> <strong>-1.fact</strong>
<em>java.lang.IllegalArgumentException: invalid negative number -1</em>
<em>  ammonite.$sess.cmd0$Natural$given_Conversion_Int_Natural$.apply(cmd0.sc:1529)</em>
<em>  ammonite.$sess.cmd3$.<clinit>(cmd3.sc:1543)</em>


<em>@</em> <strong>5.fact</strong>
<em>res3: BigInt = 120</em>
<em>@</em> <strong>1_000.fact</strong>
<em>res4: BigInt = 402387260077093773543702433923003985719374864210714632543799910429938512398629020592044208486969404800479988610197196058631666872994808558901323829669944590997424504087073759918823627727188732519779505950995276120874975462497043601418278094646496291056393887437886487337119181045825783647849977012476632889835955735432513185323958463075557409114262417474349347553428646576611667797396668820291207379143853719588249808126867838374559731746136085379534524221586593201928090878297308431392844403281231558611036976801357304216168747609675871348312025478589320767169132448426236131412508780208000261683151027341827977704784635868170164365024153691398281264810213092761244896359928705114964975419909342221566832572080821333186116811553615836546984046708975602900950537616475847728421889679646244945160765353408198901385442487984959953319101723355556602139450399736280750137837615307127761926849034352625200015888535147331611702103968175921510907788019393178114194545257223865541461062892187960223838971476088506276862967146674697562911234082439208160153780889893964518263243671616762179168909779911903754031274622289988005195444414282012187361745992642956581746628302955570299024324153181617210465832036786906117260158783520751516284225540265170483304226143974286933061690897968482590125458327168226458066526769958652682272807075781391858178889652208164348344825993266043367660176999612831860788386150279465955131156552036093988180612138558600301435694527224206344631797460594682573103790084024432438465657245014402821885252470935190620929023136493273497565513958720559654228749774011413346962715422845862377387538230483865688976461927383814900140767310446640259899490222221765904339901886018566526485061799702356193897017860040811889729918311021171229845901641921068884387121855646124960798722908519296819372388642614839657382291123125024186649353143970137428531926649875337218940694281434118520158014123344828015051399694290153483077644569099073152433278288269864602789864321139083506217095002597389863554277196742822248757586765752344220207573630569498825087968928162753848863396909959826280956121450994871701244516461260379029309120889086942028510640182154399457156805941872748998094254742173582401063677404595741785160829230135358081840096996372524230560855903700624271243416909004153690105933983835777939410970027753472000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</em></code></pre>

  <hr/>
  <p>Esse foi o fatorial em orienta√ß√£o a objetos usando Scala. Voc√™ consegue baixar
    o c√≥digos do Gist:</p>
  <ul>
    <li><a target="_blank" href="https://gist.github.com/cacilhas/4623d84e19653b3d434f1f84befc5b0a"><code>natural.sc</code></a></li>
    <li><a target="_blank" href="https://gist.github.com/cacilhas/a56c78c34a261caebd2ae1c58023b20c"><code>fact.sc</code></a></li>
  </ul>

  <center>
    <iframe
      width="560"
      height="315"
      src="https://www.youtube.com/embed/AWIuE28B5KA"
      title="Orienta√ß√£o a Objetos"
      frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen
    ></iframe>
  </center>
  <script src="js/prettify.js"></script>
</div>
